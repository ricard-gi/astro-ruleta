---


// funció que retorna la hora actual en format hh:mm:ss
function getCurrentTime() {
    const date = new Date();
    const year = date.getFullYear();
    const month = String(date.getMonth() + 1).padStart(2, "0"); // Months are zero-based
    const day = String(date.getDate()).padStart(2, "0");
    const hours = String(date.getHours()).padStart(2, "0");
    const mins = String(date.getMinutes()).padStart(2, "0");
    const secs = String(date.getSeconds()).padStart(2, "0");

    return `${hours}:${mins}:${secs}`;
}

// funció que retorna una jugada random
function jugadaRandom() {
    return Math.floor(Math.random() * 11);
}

function calculaJugada(jugada, numeroRuleta) {
    let increment = -10;

    if (isNaN(jugada)) {
        if (
            (jugada === "parell" && [2, 4, 6, 8, 10].includes(numeroRuleta)) ||
            (jugada === "imparell" && [1, 3, 5, 7, 9].includes(numeroRuleta)) ||
            (jugada === "vermell" && [1, 3, 6, 8, 9].includes(numeroRuleta)) ||
            (jugada === "negre" && [2, 4, 5, 7, 10].includes(numeroRuleta))
        ) {
            increment = 10;
        }
    } else {
        if (jugada == numeroRuleta) {
            increment = 90;
        }
    }

    return increment;
}

// funció que actualitza la cookie, afegint la informació de la jugada, ordinador i resultat
// afegim el timestamp actual
// la cookie sempre es guarda en JSON
function updateCookie(jugada, ruleta, resultat) {
    let cookie = Astro.cookies.get("ruleta");
    let cookieData = JSON.parse(cookie.value);
    let saldo = cookieData.length ? cookieData[cookieData.length - 1].saldo : 150;
    saldo *= 1;
    saldo += resultat;
    let afegim = { jugada, ruleta, saldo }
    cookieData.push(afegim);
    let x = Astro.cookies.set("ruleta", JSON.stringify(cookieData), { path: "/" });
    console.log("xook: ", afegim, cookieData.length)
}

// llegim de la URL la jugada que ha fet l'usuari: valors possibles PEDRA, PAPER, TISORA
const { jugada } = Astro.params;
const numeroRuleta = jugadaRandom();

// mirem si és guanyador o perdedor, resultat serà 90, 10 o -10
const resultat = calculaJugada(jugada, numeroRuleta);

// actualitzem la cookie amb la nova jugada
updateCookie(jugada, numeroRuleta, resultat);
console.log(`---${jugada}---${numeroRuleta}---${resultat}`)

//tornem a /
return Astro.redirect("/");

---
